---
title: 新功能添加引入bug
tags: [work]
---

在已有系统上进行功能的维护性添加问题。最近，在原有的一些系统中引入了一个新的模块，该模块会对现有模块的记录数据进行查询和更新。

问题：

由于时间比较紧张，就采用了直接开发，相应的更新数据方法也是自己重新编写，没有使用原来的方法（原来方法不太合适，可能需要调用多个方法才能完成）。后来，需要更改一个原有系统的bug，发现最近添加的模块由于自己创建了新的方法更新数据，而没有采用已有的方法调用，造成修改bug时，新增加的模块更新方法也要单独处理，如果没有发现这部分代码，很可能就会造成系统的一个漏洞。

解决方法：

每次有新的需求时，需要进行一个评估会议。判断新需求是否会对原有系统模块的数据进行更新。

1）如果没有涉及到更新

可以放心的开发和使用，但在使用查询功能时，也尽量调用已有方法。

2）如果涉及到原有模块的数据更新

需要进一步分析，是否需要对原有系统模块进行新接口的定义，定义的新接口的具体实现，并作一个详细的记录。评估其可能产生的影响。在新接口的实现上尽量使用原有方法，减少方法的创建。

想法：

为了使更新和插入数据更通用，需要设置更全字段的更新和插入，也因此需要在执行这些操作时，需要先完善对象的值，不能使用一部分对象数据就直接更新或插入，会造成部分数据被空值覆盖。在使用hibernate时，更新操作就是进行全量的更新。在hibernate中想要部分字段更新可利用Query对象实现。所以，在处理hibernate底层数据时，一般都会先加载一遍（利用缓存），然后再处理。

```
public void update(){  
    Session session =  HibernateUitl.getSessionFactory().getCurrentSession();  
    session.beginTransaction();  
    Query query = session.createQuery("update Teacher t set t.name = 'yangtianb' where id = 3");  
    query.executeUpdate();
    session.getTransaction().commit();  
} 
```