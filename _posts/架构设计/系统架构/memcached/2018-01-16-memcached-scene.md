---
title: memcached企业中的应用场景
tags: [memecached]
---

memcache服务器作为数据库的查询数据缓存，增加memcache服务的好处除了可以分担数据库的压力，同时也无需改动整个网站的架构。只需要修改程序首先读取cache查询数据，另外，更新数据时也要更新缓存。

memcache放置在动态web的后端，数据库集群的前端。静态web服务器不需要使用memcache服务器，经常采用ngix，varnish等来做缓存。

注：memcache针对的是动态业务数据。

1）完整缓存

例如，京东的商品分类，商品分类数据一般有内部员工管理录入，数据的不会经常变换。

注：类似这部分的数据一般会在系统启动时就加载到内存（预热）。

注2：由内部员工管理的，变化很小的数据，非常适合完整缓存。

2）热点缓存

热点缓存一般是指由用户更新的数据，例如淘宝的卖家，当卖家增加商品后，淘宝网就会把商品写入数据库，同时将数据放入的memcache中。

注：该过程可以通过程序实现，也可以在数据库上安装memcache插件，直接由数据库触发更新内容到memcached中。

3）淘宝秒杀抢购场景

秒杀抢购高并发的业务场景，必须要事先预热memcached，然后再逐步动态更新。如果缓存中没有对应的数据，则去数据库中读取，把读到的数据放入缓存。如果数据库里的数据更新了，需要同时出发缓存更新，防止给用户过期的数据。

秒杀关键点主要有3点：第一，秒杀只是秒杀资格，不对应业务处理；第二，排队，使用队列处理（将请求先放到队列中，平缓处理每个请求，防止大的并发导致系统崩溃）。第三，为了高效必须将数据预热放到内存中（加快处理进程）。

4）作为集群节点的session会话共享存储

用户登录系统时，集群中的应用服务器1来处理用户的请求，登录成功后将用户的登录信息保存到memcache服务器，而集群中的其他应用服务器也能通过该memcache服务器获取用户登录的信息。

参考：http://oldboy.blog.51cto.com/2561410/1331316

注：也可以考虑使用cookie保持会话，将更多的信息放置在客户端。在请求时cookie会放在head中一起提交到服务器。

注2：同时也可以考虑使用lvs -p或nginx的ip_hash等来实现session的共享

5）memcache在大型网站中的应用

memcache在大型网站中也主要是用来缓存数据库，减轻数据库访问压力。几乎所有的网站，当访问量增大时，在整个网站集群架构中最先出现瓶颈的几乎都是数据库角色以及存储角色的服务器。因此，在工作中尽量把用户的请求往整个网站架构的前面推，即当用户请求数据时，越是在靠近用户端就把数据返回效果越好。

参考：http://oldboy.blog.51cto.com/2561410/736710

大型网站的常用做法：大型网站一般会把动态变静态，即加载动态数据，生成静态页面，将文件放置到静态服务器端，甚至直接放在CDN位置。

注：最大的问题就是数据一致性问题，包括数据库更新的数据，memcache缓存数据失效，静态文件重新生成等问题。

注2：数据是要进行分类的，必须要懂得业务。因为数据有的更新频繁，有的不经常变动，针对不同类型的数据，都可以采用不同的方式来处理和缓存（不同的业务数据应用不同的场景）。

大型网站中数据库一般会做读写分离，如果数据库压力还是大，就要考虑对数据库进行拆分，包括水平拆分和垂直拆分。