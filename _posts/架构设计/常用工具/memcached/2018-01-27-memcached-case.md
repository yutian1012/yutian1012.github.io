---
title: memcached的案例
tags: [memecached]
---

### 在一个网站中使用搜索框检索，查询很慢。

1）原因

使用数据库查询，并且使用like（前后百分号的方式）进行查询的语句特别多，导致数据库负载很高。like（前后百分号的方式）的语句对于mysql数据库没有优化的余地。

首先数据库不是做检索用的，检索需要单独的检索服务器（如solr检索）。

2）优化思路

a.从业务上实现用户登录后再搜索，减少用户搜索的频率，从而减轻数据库服务器的压力。

b.限制爬虫对网站服务器的压力，通过分析日志对个别IP进行封查。

c.配置多个主从同步，程序上实现读写分离，减轻主库读写压力。

d.在数据库前端夹上memcached缓存服务器。

e.搜索sphinx实现搜索功能。

注：Sphinx是一个基于SQL的全文检索引擎，可以结合MySQL，PostgreSQL做全文搜索。

### 搜索架构

如百度的搜索框架的实现，百度的搜索框，能够提供各类搜索数据，实现用户方便的搜索查询。

1）爬虫服务器集群

该集群是用来收集所有门户网站的网页信息，采集获取网页信息。

2）建立索引服务器集群

将爬到的数据建立索引，存储数据。为搜索服务器提供数据服务。

3）对外提供服务

提供搜索服务的集群，能够允许用户搜索信息。

### 内部搭建搜索服务器

web业务数据将信息保存到db中，传统方式是通过数据库的搜索功能提供查询。这样效率非常低，而且很容易给数据库服务器造成大的负载压力。影响系统的正常运转。

1）web业务

web应用将数据存储到db中（与传统服务类似）。

2）建立索引服务器

通过特定的算法从db数据库中读取应用服务器数据，每天全量，每5分钟一次增量的方式生成索引，将索引信息存放到索引服务器集群中。

3）提供搜索服务器集群

搜索服务器集群实现对内部用户的搜索服务，通过查询索引服务器获取数据。