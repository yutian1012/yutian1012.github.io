---
title: memcached介绍
tags: [memecached]
---

memcached主要解决的是数据库读并发的压力。

1）介绍

Memcached 是一个高性能的分布式内存对象缓存系统，用于动态Web应用以减轻数据库负载。它通过在内存中缓存数据和对象来减少读取数据库的次数，从而提高动态、数据库驱动网站的速度。Memcached基于一个存储键/值对的hashmap。其守护进程（daemon ）是用C写的，但是客户端可以用任何语言来编写，并通过memcached协议与守护进程通信。

注：出现的原因，是为了解决传统关系型数据库访问压力。

注2：Memcached服务是一个C/S架构，分为服务器端和客户端两部分。

2）作用

传统的web引用一般都是有关系型数据库，随着数据量的增大、访问的集中，使关系型数据库负担越来越大，响应缓慢。

使用Memcached主要目的是，通过在自身内存中缓存数据库的查询结果，减少数据库的访问次数，提高动态web应用的速度、提高网站架构的并发能力和扩展能力。Memcached服务启动时，会事先规划好一部分系统内存空间，在该空间中存放数据库中的各类数据。

注：memcache主要是做数据库的缓存

3）常见的缓存服务软件

Memcached，纯内存，用于缓存后端数据库的数据。常见应用：博文、BBS帖子、支付内容、用户信息。

Memcachedb/redis，能够持久化存储（内存加磁盘）。用于缓存后端数据库的查询数据，另外也可以作为数据库的存储补充。常见应用：博文、BBS帖子、支付内容、用户信息：另外可以存储好友关注、粉丝以及业务统计。

squid/nginx，内存加磁盘，用于前端web内容的缓存。常见应用：前端静态数据缓存（如，图片，附件，js，css，html等）。

varnish，内存，用于前端web内容的缓存。常见应用：前端静态数据缓存（如，图片，附件，js，css，html等）。

注：squid，nginx，varnish主要用于web前端页面内容的缓存。

### Memcached工作流程

1）读数据

![](images/architecture/memcached/readworkflow.png)

1.浏览器访问应用服务器，程序首先检查客户端请求的数据是否在memcahced缓存中存在，，如果存在，直接把请求的数据返回，不再请求后端数据库。

2.如果请求的数据在Memcached缓存中不存在，则程序会去数据库服务器查询，将数据信息返回给浏览器，同时把新数据缓存到memcahced缓存中，供下次访问使用。

2）写数据

![](images/architecture/memcached/writeworkflow.png)

当程序更新或删除数据时，会首先处理数据库的数据。同时，通知memcached中对应的旧数据失效，从而保证memcached中缓存的数据始终和数据库中的数据一致，这个一致性非常重要。

当分配给memcached内存空间用完后，Memcache自身会使用LRU（Last Recently Used，最近最少使用）到期失效策略。数据替换时会首先替换失效的数据，其次替换最旧未使用的数据。

如果是在高并发的场合下，程序除了要通知Memcached过期的失效数据外，还会要把更新过的数据推送到memcached中缓存起来。这样可以减少第一次查询数据库带来的访问压力，提升memcached中缓存的命中率。

### memcached特性

1）C/S模式架构

memcached是一套C/S模式的架构软件，由C语言编写。

2）协议简单

Memcached的协议实现比较简单，使用的是基于文本行的协议，能通过telnet/nc直接操作memcached服务器存取数据。

3）支持epoll/kqueue异步I/O模型，使用libevent作为事件处理通知机制

libevent是一套利用C开发的程序库，能将BSD系统的kqueue，linux系统的epoll等事件处理功能封装成一个接口。确保即使服务器端的连接数增加也能发挥很好的性能。memcached就使用这个库进行异步事件处理。

4）key/value键值对的数据类型，通过key存取值

5）全内存缓存，效率高

memcached有一套自己管理内存的方法，全部数据都存放于memcached服务器事先分配的内存中。无持久性存储的设计，和系统内存一样，重启系统或memcached服务器，memcached内存中的数据就丢失了。

注：如果不能允许数据丢失可以考虑使用memcachedb或redis。一般使用memcached服务，数据都不是非常敏感的，允许丢失。

6）支持分布式集群

memcached多个分布式集群节点是互不通信的，每一台服务器都是独立存取数据，之间不共享任何数据信息。

注：是通过客户端程序的设计，让memcached具有分布式，支持海量缓存和大规模应用。

### memcached主要问题

1）数据一致性

可以通过消息队列通知memcached失效并更新数据。同时可以通过应用程序通知失效。即能够通过多种途径（单一或多次）通知的方式实现数据一致性。

2）分布式

客户端使用一致性哈希算法来定位服务器。