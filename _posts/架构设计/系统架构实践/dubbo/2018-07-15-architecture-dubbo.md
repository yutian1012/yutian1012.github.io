---
title: 使用dubbo搭建微服务架构
tags: [architecture]
---

实现微服务，最基本的dubbo工程包括服务提供方，消费方和服务接口等组件。

使用springboot作为微服务的开发工具，能快速构建微服务。下面将使用springboot；来构建微服务。

1）服务注册中心

zookeeper是apache hadoop的子项目，主要是用来解决分布式应用中经常用遇到的一些数据管理问题，如统一命名服务、状态同步、集群管理、分布式应用配置项的管理等。

注：安装zookeeper或zookeeper集群实现服务注册中心

2）接口工程

这里定义微服务端的公共接口。

注：使用springboot搭建公共接口

3）服务端

微服务的实现者，通过系统资源的使用服务，供客户端调用，或其他微服务使用。

注：使用springboot搭建相应的服务端微服务。

4）消费端

消费端既可以是客户端，也可以是相互协作的微服务端，实现微服务的调用。

注：使用springboot搭建相应的消费端微服务。

5）网关

用于聚合多个微服务，对外提供统一的入口服务。常使用RestController等类提供restful方式的接口。对外屏蔽掉内部微服务的调用关系，使客户端使用起来更方便，同时也使微服务更安全。

单独提供一个工程作为网关服务，开发固定端口代理所有模块提供的服务，并通过拦截器验证所有外部请求以达到权限管理的目的。外部应用可以是app、网站、桌面客户端。为了达到通用性的目的，网关服务一般为web服务，通过http协议提供RESTful分隔的API接口。

注：使用springboot搭建吸纳供应的web服务作为网关。

6）监控中心

使用dubbo-admin子项目，可实现微服务的监控。主要用于路由规则、动态配置、服务降级、访问控制、权重调整、负载均衡的管理。

注：使用maven工具编译dubbo-admin项目，并在tomcat中运行

7）服务管理

启动服务提供方法或服务消费方项目后，并可在服务治理目录下的提供者与消费者页面中查看对应的项目。

注：通过dubbo-admin项目查看

8）负载均衡

当单独一台服务无法满足高并发的请求时，可通过集群部署多台服务器。负载均衡提供相应的策略，用来解决集群如何接收并处理请求的策略。

注 ：配置负载均衡策略可以在服务提供方（@Service注解），消费方（@Reference注解）中修改LoadBalance参数。也可以通过dubbo-admin中使用图形化界面完成配置。

注2：可以使用dubbo-admin项目在服务治理目录下的负载均衡页面查看并配置

9）服务降级

分布式环境下服务之间存在一定的依赖关系，当整个依赖链中的某服务崩溃或网络不通时，远程服务无法调用成功并抛出RpcException异常。为了避免由一个服务崩溃而引起的连锁反应以及保证主业务的正常运行，可以对服务进行降级处理，在调用失败后返回默认数据。

注：可以在服务消费端（@Reference注解）或服务提供方（@Service注解）的mock参数来配置服务降级返回的默认数据，或调用的默认处理方法。

10）集群容错

为了提高系统的可用性，将服务提供方部署成多个，组成服务集群。在消费方调用服务失败或超时后，dubbo可以配置多种策略重新调用集群中的其他服务提供方。

注：在服务方（@Service注解）或消费方的（@Reference注解）中配置cluster参数，或者使用apllication.properties文件中的spring.dubbo.service.cluster参数来指导容错策略。