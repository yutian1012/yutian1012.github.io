---
title: 使用dubbo搭建微服务架构-服务提供者@Service注解属性
tags: [architecture]
---

dubbo的@Service注解用于暴露服务，同时@Service注解提供了大量的属性配置

包括定义version版本，group分组，cache缓存，async基于NIO的非阻塞实现，timeout超时，retries重试次数，accesslog想logger中输出访问日志，mock属性可定义超时或网络异常时执行的策略（类似熔断机制），loadbalance指定服务端负载均衡，connections限制客户端服务使用连接数等。

1）服务相关的属性

register，该协议的服务是否注册到注册中心

version，指定该服务的版本

group，服务所属分组，当一个接口有多种实现时，可以用group区分。

deprecated，服务是否过时，如果设置为true，消费方引用时将打印服务过时警告error日志

accesslog，设为true，将向logger中输出访问日志，也可以填写访问日志文件路径，直接把访问日志输出到指定文件。

2）与线程相关的属性

async，基于NIO的非阻塞实现并行调用，客户端不需要启动多线程即可完成并行调用多个远程服务的功能，相对多线程开销较小。？？？

executes，在暴露服务中的每个方法，在服务器端并发执行（线程池中执行）？？？

actives，在暴露服务中的每个方法，客户端并发执行的线程数量（占用连接的请求数），微服务提供者本身也可能需要调用其他微服务，那么该微服务就是客户端。？？？

3）安全相关的属性

token，令牌验证（三种取值），如果为空，表示不开启，如果为true，表示随机生成动态令牌，否则使用静态令牌。

注：令牌的作用是防止消费者绕过注册中心直接访问，保证注册中心的授权功能有效，如果使用点对点调用，需关闭令牌功能。

dynamic，服务是否动态注册，如果设置为false，注册后将显示disable状态，需人工启用。并且服务提供者停止时，也不会自动取消注册，需人工禁用。？？？

注：这里的人工启用和人工禁用是在注册中心操作吗？

4）连接相关属性

delay，延迟暴露服务，如果你的服务需要warmup时间（预热），如初始化缓存，等待相关资源就位等，可以使用delay进行演出暴露。为-1时，表示延迟到spring初始化完成后，在暴露服务（基于spring的ContextRefreshedEvent事件触发暴露）。

timeout，调用服务时的超时时间，单位为秒

mock，为true表示使用缺省的Mock类名，即接口名+Mock后缀，服务接口调用Mock实现类，该Mock类必须有一个无参构造函数。

注：Mock与Local的区别，Local总会被执行，而Mock只在出现非业务异常（如超时，网络异常等）时执行；Local在远程调用之前执行，Mock在远程调用后执行。

retries，远程服务调用重试次数，不包括第一次调用，不需要重试则设置为0

connections，限制客户端服务使用连接数

protocol，设置该服务所有的协议，不同服务在性能上适用不同的协议传输，如大数据用短连接协议，小数据大并发用长连接协议，默认为dubbo。

loadbalance，负载均衡策略，可选值为random（随机），roundrobin（轮询），leastactive（最少活跃调用）

5）protocol协议类型

dubbo协议，采用单一长连接和NIO异步通信，适合于小数据两大并发的服务调用，以及服务消费者机器数远大于服务提供者机器数的情况（客户端多）。

hessian协议，传入传出参数数据包较大，提供者比消费者个数多，提供者压力较大，可传文件。

RMI协议，采用JDK标准的java.rmi实现，常规远程服务方法调用，与原生RMI服务互操作。

HTTP协议，可用浏览器查看，通过表单或URL传入参数

WebService协议，SOAP文本序列化，多用于系统集成，跨语言调用

Thrif协议，对thrift（Facebook的RPC框架）的原生协议的扩展。