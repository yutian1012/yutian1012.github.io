---
title: 使用dubbo搭建微服务架构-服务降级
tags: [architecture]
---

分布式环境下服务之间存在一定的依赖关系，当整个依赖链中的某服务崩溃或网络不通时，远程服务无法调用成功并抛出RpcException异常。

为了避免由于一个服务崩溃而引起的连锁反应以及保持主业务的正常运行，可以对服务进行降级处理。在调用失败后返回默认数据。

注：在部分服务崩溃时访问网站，页面中由崩溃的服务提供的数据为空会比整个网站无法打开要好的多。

### 2种配置方式

dubbo通过mock实现服务降级

1）通过注解属性mock设置

在@Reference注解的mock属性上设置返回数据，针对同一个接口的所有方法都返回该数据。

```
@Reference(mock="return null")
private IHello hello；
```

表示当远程调用失败时则直接返回null

2）通过注解属性mock设置一个处理类

mock可以指定一个具体的类，当调用失败时执行，以满足复杂的业务逻辑。mock类需要实现服务即可，类名规范为：接口类+Mock。这种方式可针对接口中不同的方法返回不同的默认值。

```
@Reference(mock="org.sjq.dubbo.mock.IHelloMock")
```