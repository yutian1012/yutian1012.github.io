---
title: struts核心与配置
tags: [struts]
---

### 1. Struts2工作原理

![](/images/java_structure/struts/strutscore.jpg)

FilterDispatcher是控制器的核心，就是mvc中c控制层的核心。

### 2. struts2类型转换

实例：创建一个用户注册功能，实现类型转换

1）创建并显示注册页面

创建注册页面：

```
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" isELIgnored="false"%>
<%@taglib prefix="s" uri="/struts-tags"%>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>注册用户</title>
</head>
<body>
<s:form action="/user/test/register">
    <s:textfield name="username" label="用户名"/>
    <s:textfield name="password" label="密码"/>
    <s:textfield name="birthday" label="出生日期"/>
    <!-- 电话号码个数为xxx-xxxxxx的形式 -->
    <s:textfield name="phoneNumber" label="电话号码"/>
    <s:submit value="注册"/>
</s:form>
</body>
</html>
```

创建处理类：

```
public class RegisterAction extends ActionSupport{
    /**
     * 跳转到注册页面
     * @return
     */
    public String toRegister(){
        return "toRegister";
    }
}
```

配置页面跳转

```
<!-- 注册 -->
<action name="toRegister" class="org.sjq.action.RegisterAction" method="toRegister">
    <result name="toRegister">/WEB-INF/jsp/login/register.jsp</result>
</action>
```

访问页面：

```
http://localhost:8080/java_struts/user/test/toRegister
```

2）处理表单数据

Action处理类修改：

```
public class RegisterAction extends ActionSupport implements ModelDriven<RegisterModel>{
    private RegisterModel registerModel =new RegisterModel();
    
    @Override
    public RegisterModel getModel() {
        return this.registerModel;
    }
    /**
     * 跳转到注册页面
     * @return
     */
    public String toRegister(){
        return "toRegister";
    }
    /**
     * 注册
     * @return
     */
    public String register(){
        if(null!=registerModel){
            System.out.println(registerModel.getUsername()+registerModel.getPassword()+registerModel.getBirthday()+registerModel.getPhoneNumber());
            return SUCCESS;
        }else{
            return ERROR;
        }
    }
}
```

注：将页面参数都封装到了RegisterModel类中，并且提供register方法模拟注册。

配置页面跳转：

```
<action name="register" class="org.sjq.action.RegisterAction" method="register">
    <result name="success" type="redirect">/WEB-INF/jsp/login/register.jsp</result>
    <result name="error" type="redirect">/WEB-INF/jsp/login/register.jsp</result>
</action>
```

提交表单测试报错

```
HTTP Status 404 - No result defined for action org.sjq.action.RegisterAction and result input
```

错误原因，这个报错肯定是这个action发生了内部错误，然后自动转去名为input的result，之后发现你没有定义名为input的result而报错。配置log4j并设置输出level为debug。

3）定义全局转换类

resources目录下创建文件xwork-conversion.properties，编辑文档内容

```
org.sjq.model.PhoneModel=org.sjq.conversion.PhoneModelConversion
```




Struts2输入校验

Struts2实现文件上传及下载


### struts如何输出错误信息？
通过配置log4j实现，

tomcat启动的错误信息：

```
ERROR StatusLogger Log4j2 could not find a logging implementation. Please add log4j-core to the classpath. Using SimpleLogger to log to the console...
```

1）引入log4j的jar包：

```
<dependency>
    <groupId>org.apache.logging.log4j</groupId>
    <artifactId>log4j-core</artifactId>
    <version>2.7</version>
</dependency>
```

2）添加log4j的配置文件（放置在resources目录下，即部署后的class目录下）

```
<?xml version="1.0" encoding="UTF-8"?>  
<Configuration>  
  <Appenders>  
    <Console name="Console" target="SYSTEM_OUT">  
      <PatternLayout pattern="%d{HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n"/>  
    </Console>  
  </Appenders>  
  <Loggers>  
    <Root level="info">  
      <AppenderRef ref="Console"/>  
    </Root>  
  </Loggers>  
</Configuration>
```

注：文件名为log4j2.xml