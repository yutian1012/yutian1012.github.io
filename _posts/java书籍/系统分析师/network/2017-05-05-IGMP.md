---
title: 系统分析师（软考）--IGMP Internet组管理协议
tags: [analysis]
---

全称Internet Group Management Protocol（Internet组管理协议），该协议运行于主机和与主机直接相连的组播路由器之间，是IP主机用来报告多址广播组成员身份的协议。

通过IGMP协议，一方面可以通过IGMP协议主机通知本地路由器希望加入并接收某个特定组播组的信息；另一方面，路由器通过IGMP协议周期性地查询局域网内某个已知组的成员是否处于活动状态。

注：多播/组播使用的协议，是网络层协议

### 1. 多播组成员

IGMP 使多播路由器知道多播组成员信息 

![](/images/book/tech-analysis/net/IGMP-dispatch.png)

IGMP 并非在因特网范围内对所有多播组成员进行管理的协议。

IGMP 不知道 IP 多播组包含的成员数，也不知道这些成员都分布在哪些网络上。

IGMP 协议是让连接在本地局域网上的多播路由器知道本局域网上是否有主机（严格讲，是主机上的某个进程）参加或退出了某个多播组。

### 2. IGMP数据包

和 ICMP 相似，IGMP 使用 IP 数据报传递其报文（即 IGMP 报文加上 IP 首部构成 IP 数据报）。

![](/images/book/tech-analysis/net/IGMP.jpg)

IGMP类型为1说明是由多播路由器发出的查询报文，为2说明是主机发出的报告报文。检验和的计算和ICMP协议相同。组地址为D类IP地址。在查询报文中组地址设置为0，在报告报文中组地址为要参加的组地址。封装在IP报中，这样路由器就自然知道了加入组的主机地址了。

### 3. 加入多播组

当第一个进程加入一个组时，主机就发送一个IGMP报告。如果一个主机的多个进程加入同一组，只发送一个IGMP报告。这个报告被发送到进程加入组所在的同一接口上。

多播的基础就是一个进程的概念（进程是指操作系统执行的一个程序），该进程在一个主机的给定接口上加入了一个多播组。在一个给定接口上的多播组中的成员是动态的—它随时因进程加入和离开多播组而变化。

这里所指的进程必须以某种方式在给定的接口上加入某个多播组。进程也能离开先前加入的多播组。这些是一个支持多播主机中任何API所必需的部分。使用限定词“接口”是因为多播组中的成员是与接口相关联的。一个进程可以在多个接口上加入同一多播组。

这里暗示一个主机通过组地址和接口来识别一个多播组。主机必须保留一个表，此表中包含所有至少含有一个进程的多播组以及多播组中的进程数量。

### 4. IGMP报告和查询

1）进程离开一个组时，主机不发送IGMP报告，即便是组中的最后一个进程离开。主机知道在确定的组中已不再有组成员后，在随后收到的IGMP查询中就不再发送报告报文。

2）多播路由器定时发送IGMP查询来了解是否还有任何主机包含有属于多播组的进程。多播路由器必须向每个接口发送一个IGMP查询。因为路由器希望主机对它加入的每个多播组均发回一个报告，因此IGMP查询报文中的组地址被设置为0.

3）主机通过发送IGMP报告来响应一个IGMP查询，对每个至少还包含一个进程的组均要发回IGMP报告。

使用这些查询和报告报文，多播路由器对每个接口（每个多播组）保持一个表，表中记录接口上至少还包含一个主机的多播组。当路由器收到要转发的多播数据报时，它只将该数据报转发到（使用相应的多播链路层地址）还拥有属于那个组主机的接口上。

参考：http://blog.csdn.net/chengqianyun2002/article/details/1699235