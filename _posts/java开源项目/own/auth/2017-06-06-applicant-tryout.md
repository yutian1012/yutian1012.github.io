---
title: 应用软件试用期设置
tags: [auth]
---

参考：http://blog.csdn.net/shenxueshi/article/details/7929523

### 试用版与正式版

很多成型的应用软件都有试用版和正式版之分，试用版一般都有功能上的限制，同时也有使用次数或使用期限的限制。要使试用版成为正式版，有些软件是要求你拿注册码注册，还有一些软件是通过授权文件来区分试用版和正式版，从试用版变成正式版，只是把授权文件换一下而已。一般来说，桌面软件会采用注册码的方式较多，而服务器端软件采用授权文件的较多，授权文件一般会将要限制的信息，比如并发数、最后日期等明文、密文一块保存。

注：服务器端软件一般使用授权文件

### 思路

授权文件使用一个加密的字符串，加密字符串的内容包括2部分，一部分是日期（授权日期），另一部分是特定的字符串+日期生成的一个md5，两部分的分隔使用#号。授权文件保存时使用对称加密将两部分进行加密，密钥固化在程序中。防止授权文件以用户可读的形式展现。

注：md5加密时的特定字符串可以通过配置文件提供，md5的salt固化到程序中，对称加密密钥固化到程序中。

### 实施过程

1）将授权文件放置在固定的目录下/WEB-INF/conf/auth目录下，文件内容包括日期和md5加密串，并使用对称加密对其进行加密存储。

2）在程序中加一个过滤器（或者拦截器等方式），读取这个配置文件，通过对读取到的数据进行对称解密，将得到的日期和特定字符串进行md5加密，和从配置文件里读取到的md5密文进行比较。

3）如果两者不一致，表明授权文件遭到篡改，不再继续提供服务

4）如果两者一致，继续比较从配置文件里读取的限制日期和当前日期，如果当前日期晚于限制日期，表明使用期限已到，不再继续提供服务

5）否则继续提供服务

