---
title: JVM在server模式下字节码编译器
tags: [jvm]
---

参考：https://blog.csdn.net/chenxiusheng/article/details/74007750

C2 Compiler是JVM在server模式下字节码编译器，JVM启动的时候所有代码都处于解释执行模式，当某些代码被执行到一定阈值次数，这些代码（称为热点代码）就会被C2Compiler编译成机器码，编译成机器码后执行效率会得到大幅提升。

1）热点代码和抖动

a. 热点代码：

当某些代码被执行到一定阈值次数，这些代码就会被C2Compiler编译成机器码，从而提供执行的效率。

b. 抖动现象：

流量进来后，大部分代码成为热点代码，这个过程中C2Compiler需要频繁占用CPU来运行，当大部分热点代码被编译成机器代码后，C2Compiler就不再长期占用CPU了，这个过程也可以看作抖动。

2）解决方案

a. 预热(warm up)

最直接有效的方法是预热：可以使用Jmeter等压测工具模拟线上访问流量，让C2Compiler预先将热点代码编译成机器码, 减少对正式环境流量的影响。

b. 启动时设置多个编译线程（加速编译）

在默认值下抖动时CPU已经满载，设置成更多的线程也不一定起作用，但对于CPU高而不满的情况会有用，能减少抖动时间。

```
设置JVM启动参数：-XX:CICompilerCount=threads
```

注：默认是2， 可以设置4或6.


