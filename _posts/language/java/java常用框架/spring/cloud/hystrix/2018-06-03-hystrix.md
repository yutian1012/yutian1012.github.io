---
title: spring cloud hystrix断路器
tags: [spring]
---

1）分布式系统面临的问题

复杂的分布式体系结构中的应用程序有数十个依赖关系，每个依赖关系在某些时候将不可避免的失败。

a.服务雪崩

多个微服务之间调用的时候，假设微服务A调用微服务B和微服务C，微服务C又调用其他的微服务，这就是所谓的“扇出”。就像折扇，层层调用，层层返回。如果扇出的链路上某个微服务的调用响应时间过长或者不可用，对微服务A的调用就会占用越来越多的系统资源，金额引起系统崩溃，即雪崩效应。

b.单一服务的故障引起整体系统不可用

对于高流量的应用来说，单一的后端依赖可能会导致所有服务器上的所有资源都在几秒内饱和。比失败更糟糕的是，这些应用程序还可能导致服务之间的延迟增加，备份队列，线程和其他系统资源紧张，导致整个系统发生更多的级联故障。因此，这些服务都需要对故障和延迟进行隔离和管理，以便单个依赖关系的失败，不能导致整个应用的崩溃。

2）什么是Hytrix（即服务熔断器）

Hystrix是一个用于处理分布式系统的延迟和容错的开源库。在分布式系统里，许多依赖不可避免的会调用失败，比如超时、异常等。Hystrix能够保证在一个依赖出问题的情况下，不会导致整体服务失败，避免级联故障，以提供分别系统的弹性。

断路器，本身是一种开关装置，当某个服务单元发生故障之后，通过断路器的故障监控（类似熔断保险丝），向调用方返回一个符合预期的、可处理的备选相应（fallback），而不是长时间的等待或抛出调用方无法处理的异常，这样就保证了服务调用方的线程不会被长时间、不必要地占用，从而避免故障在分布式系统中的蔓延，乃至雪崩。

3）作用

Hytrix能够实现：服务降级，服务熔断，服务限流，接近实时的监控等。

可配置依赖调用超时时间，超时时间一般设为比99.5%平均时间略高即可。当调用超时时，直接返回或执行fallback逻辑。

依赖调用结果分：成功，失败（抛出异常），超时，线程拒绝，短路。不成功的调用（异常，拒绝，超时，短路）会执行fallback(降级)逻辑。