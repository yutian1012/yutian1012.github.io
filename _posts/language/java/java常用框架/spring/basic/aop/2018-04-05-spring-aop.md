---
title: spring应用切面
tags: [spring]
---

AOP（aspect oriented programming），面向切面编程。

AOP允许你把遍布应用各处的功能分离出来形成可重用的组件。可以将安全、事务和日志关注点与业务逻辑相分离。

1）正确理解遍布应用的各处功能

a.关注点

所谓关注点，可理解为业务逻辑实现需要相关的功能支持，这些支持功能就是要实现业务必须关注的点（或依赖的功能）。核心业务逻辑组件的实现有时要依赖日志、事务管理和安全方面的服务组件，这些系统服务通常被称为横切关注点。

AOP的目的就是要分离这些关注点，从而简化业务自身的复杂性。将这些关注点剥离出来，同时又能悄无声息的应用到业务中去，而业务代码本身不需要去考虑。

b.重复代码

如系统中大部分的业务都会需要日志和事务，传统的做法是在业务代码开始处调用日志接口（记录日志），调用事务相关的接口（开启事务），在业务逻辑实现完成后，再次调用日志接口（记录日志），调用事务接口（关闭事务）。而这样的代码会分散到业务逻辑代码的各个位置，而且代码重复。

```
public void transferMoney(){
    //记录日志
    Logger.log("xxxx");
    //开启日志
    connection.startTransaction();
    
    //执行业务逻辑
    ....

    //关闭事务
    connection.closeTransaction();
    //记录日志
    Logger.log("xxxx");
}
```

c.扰乱业务代码本身

通过上面的代码也可以看到，前面两行和最后门面的两行代码都是与业务逻辑不相关的，却不得不在方法开始和结尾处添加上。业务对象不但要知道它需要记日志，进行安全控制和参与事务，还要亲自去执行这些代码。

2）AOP思想

AOP能够使这些关注点服务模块化，并将其剥离出业务逻辑代码，而以声明的方式将它们应用到它们需要影响的组件中去。使这些组件具有更高的内聚性并且会更加关注自身的业务。完全不需要去考虑涉及系统服务所带来的复杂性。

3）切面的理解：

可以将切面理解为覆盖在很多组件之上的一个外壳，而调用组件使一定会先经过外壳的过滤，甚至出来使也要再次经过外壳的过滤。借助AOP可以使用这些各种服务功能层去包裹核心业务。这些服务层以声明的方式灵活地应用到系统中，你的核心应用甚至根本不知道它们的存在。

4）spring AOP的常用场景

基于spring AOP可应用与系统日志，声明式事务和安全等服务模块，这些模块是一些公共服务模块，大部分的业务需要显示或隐式的调用这些服务。通过AOP将其模块化，并通过声明方式配置，使大部分的业务逻辑隐式的完成这些服务的调用。