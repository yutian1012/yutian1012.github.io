---
title: 系统分析师（软考）--ICMP Internet控制报文协议
tags: [analysis]
---

ICMP是（Internet Control Message Protocol）Internet控制报文协议。它是TCP/IP协议族的一个子协议，用于在IP主机、路由器之间传递控制消息。

控制消息是指网络通不通、主机是否可达、路由是否可用等网络本身的消息。这些控制消息虽然并不传输用户数据，但是对于用户数据的传递起着重要的作用。

注：ICMP是IP层/网络层协议。

### ICMP报文内容

![](/images/book/tech-analysis/net/ICMP.png)

ICMP 报文的前4个字节（图中的第一行）是统一的格式，共有三个字段：即类型、代码和检验和。接着的 4 个字节的内容与 ICMP 的类型有关。

### ICMP报文种类

ICMP 报文的种类有两种，即 ICMP 差错报告报文和 ICMP 询问报文。

1）ICMP差错报告报文（5种类型）

终点不可达；源点抑制(Source quench) ；时间超过；参数问题；改变路由（重定向）(Redirect) 

2）ICMP查询报文（2种类型）

回送请求和回答报文；时间戳请求和回答报文

ICMP回送请求报文是由主机或路由器向一个特定的目的主机发出的询问。收到此报文的机器必须给源主机发送ICMP回送应答报文。这种询问报文用来测试目的站是否可达以及了解其有关状态。

ICMP时间戳请求允许系统向另一个系统查询当前的时间。该ICMP报文的好处是它提供了毫秒级的分辨率，而利用其他方法从别的主机获取的时间只能提供秒级的分辨率。请求端填写发起时间，然后发送报文。应答系统收到请求报文时填写接收时间戳，在发送应答时填写发送时间戳。大多数的实现是把后面两个字段都设成相同的值。

### ICMP应用

PING 用来测试两个主机之间的连通性。PING使用了ICMP回送请求与回送回答报文。PING是应用层直接使用网络层 ICMP 的例子，它没有通过运输层的 TCP 或UDP。