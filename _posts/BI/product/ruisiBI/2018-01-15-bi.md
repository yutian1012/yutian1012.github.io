---
title: ruisiBI
tags: [BI]
---

### 场景

自主开发的系统中存在一些统计信息数据，为了方便用户查看数据的统计报表及统计图形，同时也能够提供用户自定义统计的对数据进行统计。现系统需要对接一个BI系统实现自定义的统计，在需求调研过程中找到一家国内部分开源的BI系统（睿思BI）。

### 数据的处理

数据分为3部分：外部导入，关联聚合，数据填报。最终处理的数据表或数据集会存放到yunbi数据库中。

1）原始数据导入系统

数据导入目的是将待统计的数据信息统一放到一个库中，导入的方式主要包括csv，excel，数据库导入。

注：该功能主要是实现将外部需要统计的数据导入到系统中，便于后续的统计操作

2）对原始数据进行加工

直接导入系统的数据，这里成为元素数据。对于大部分的原始数据并不能很好的支持数据的统计，因此，需要对这部分数据进行一个加工处理。

方式一：提供了对数据库中已有的表数据可以进行关联、聚合生成新的数据表。

方式二：通过sql脚本查询表（多表或单表），将查询到的结果集构造成新的数据表。

注：在已有的数据上进行抽取出来，生成视图，临时表，方便统计。

3）数据的填报

第三部分的数据来源是通过数据填报信息存放到数据库中。这里可以自定义一些数据表结构，通过用户录入的形式保存起来，也作为统计数据的来源。

### 查询操作

查询操作的数据是针对上面的三种方式中获取的数据，并不支持外部数据源的直接查询统计。即必须把外部数据源导入到该系统中才能进一步统计（缺陷）。

注：查询操作针对的数据源时系统中的数据表，不是经过建模的数据。

数据的查询提供了三种展现方式：列表的方式，透视表，透视图。

1）透视表方式

需要设置行标签、列标签以及度量。行和列作为展示的维度（分析问题的角度），度量作为统计值（求和，平均值）。

2）透视图方式

主要设置三个位置：横轴（维度），纵轴（度量，支持统计函数），图例（维度，在上方可以条件值）。

### 数据建模

多维模式是基于维度及度量的数据立方体，维度指观察事物的角度（如时间、地域），度量是计量事物的数据（如长度，金额等）。

1）目的：

建模是为了设计立方体结构数据。在数据源中选择单表或单数据集进行建模操作。不支持多表关联的建模，全部操作都是单表进行的（缺陷）。另外，在多维分析模块和数据报表模块都会用到建模数据。

2）建模过程

数据表：

数据表dm_zjfx（系统提供的测试数据表），这部分的数据可以是多个表整合到一起的视图或临时表。

```
# 这里只取出来部分字段信息
select year,month_id as month,floor_name as floor,shop_name as shop,brand_name as brand,gdzj,cczj from dm_zjfx limit 1,2;

# 年份    月份      楼层  商店      品牌                固定租金  抽成租金
+------+--------+-------+--------+-------------------+--------+--------+
| year | month  | floor | shop   | brand             | gdzj   | cczj   |
+------+--------+-------+--------+-------------------+--------+--------+
| 2013 | 201301 | 1F    | 1F0202 | CK CALVIN KLEIN   | 725.00 | 309.00 |
| 2013 | 201301 | 1F    | 1F03A1 | CAMPER+FRED PERRY | 926.00 |  61.00 |
+------+--------+-------+--------+-------------------+--------+--------+

# 其中年份、月份、楼层、商店、品牌等字段适合作为统计维度
# 固定租金，抽成租金适合作为度量字段。
```

动态设置字段：

系统建模时选择该数据表时，可对度量信息进行分类。可设置动态字段，如将固定租金+抽成租金设置为总组件字段，在统计时可以使用。

设置数据立方体：

可对维度和度量进行分组，如维度可以按日期（年份，月份）、商城（楼层，商店）和品牌分组（品牌）

![](/images/BI/product/ruisiBI/buildmodel.png)